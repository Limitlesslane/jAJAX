/*
 MIT
  @version 1.0.3
  @git https://github.com/duzun/jAJAX
  @umd AMD, Browser, CommonJs
  @author DUzun.Me
*/
(function(A,r,v,q,G,t){("function"==typeof define&&define.amd?define:"undefined"!=typeof module&&module.exports?function(r,l){module.exports=l()}:function(q,l){r[A]=l()})([],function(){var B=v.noop||function(){},l=v.prototype,w=l.hasOwnProperty,H=l.toString,I="function"==typeof t.now?function(){return t.now()}:function(){return new t.getTime},C=function(e){return null===e?"Null":void 0===e?"Undefined":H.call(e).slice(8,-1)},D=function(e){return e instanceof G||"Function"==C(e)},x=D(q.isArray)?q.isArray:
q.isArray=function(e){return e instanceof q||"Array"==C(e)},f=function(e,h){if(!e)return e;var a,d,f;(d=x(e))||(d=w.call(e,"length")&&"number"===typeof e.length&&!D(e));if(d)for(a=0,f=e.length>>>0;a<f;a++){if(w.call(e,a)&&(d=e[a],!1===h.call(d,a,d,e)))return a}else for(a in e)if(w.call(e,a)&&(d=e[a],!1===h.call(d,a,d,e)))return a;return e},J=function(e){function h(a,d){e[a]=d}f(arguments,function(a,e){a&&f(e,h)});return e},g="undefined"!==typeof self&&"function"==typeof self.setTimeout?self:r;"function"!=
typeof g.setTimeout&&"undefined"!==typeof require&&(g=require("sdk/timers"));var y=g.setTimeout,K=g.clearTimeout,E={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},g=function h(a,d,g){var b=h.createXHR(!1);if(!b)return g&&g(null,"xhr","Couldn't create XHR object"),b;"string"==typeof a&&(a={url:a});a=J({url:"",type:"GET",cache:!1,timeout:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"",mimeType:"",
data:null,headers:null,error:null,success:null},a);var l={},n=function(a,c){l[a.toLowerCase()]=[a,c]},c=a.type,s,k=function(F,c,d,k){a.error&&a.error(d||k,c,F,k);g&&g(d||k,c,F,k)},L=function(c,z){var b=c.responseText,s=a.dataType||h.mimeToDataType(a.mimeType||c.getResponseHeader("content-type")),f;try{switch(s){case "json":b="responseJSON"in c?c.responseJSON:/^\s*$/.test(b)?null:h.parseJSON(b);break;case "xml":b=c.responseXML;break;case "script":(0,eval)(b)}}catch(g){f=g}f?k(f,"parsererror",c,z):
(a.success&&a.success(b,c.statusText,c,z),d&&d(b,c.statusText,c,z))},p=function(a,c){s&&K(s);200<=a.status&&300>a.status||304==a.status?L(a,c):k(a.statusText||null,a.status?"error":"abort",a,c)};f({"X-Requested-With":"XMLHttpRequest"},n);a.contentType&&n("Content-Type",a.contentType);n("Accept",(E[a.dataType]?E[a.dataType]+", ":"")+"*/*; q=0.01");f(a.headers,n);if("REQUEST"==h.xhr_type){f(a.data,function(a,c,b){null==c&&delete b[a]});var m={url:a.url,content:a.data?a.data:{},headers:{},onComplete:function(a){m.aborted||
p({getResponseHeader:function(c){return a.headers[c]},status:a.status,statusText:a.statusText,responseText:a.text,responseJSON:a.json},a)}};f(l,function(a,c){c[0]&&null!=c[0]&&(m.headers[c[0]]=c[1])});a.contentType&&(m.contentType=a.contentType);0<a.timeout&&(s=y(function(){m.aborted=I();k(null,"timeout",b)},a.timeout));c=c.toLowerCase();try{b.Request(m)[c]()}catch(r){try{m.headers["X-HTTP-Method-Override"]=c.toUpperCase(),b.Request(m).post()}catch(M){switch(c){case "delete":var u=new (require("sdk/net/xhr").XMLHttpRequest);
u.open(c,a.url);f(m.headers,function(a,c){u.setRequestHeader(a,c)});u.send();p(u);break;default:throw M;}}}}else c=c.toUpperCase(),b.open(c,a.url,!0),f(l,function(a,c){null!=c[1]&&b.setRequestHeader(c[0],c[1]+"")}),0<a.timeout&&(s=y(function(){b.onreadystatechange=B;b.abort();k(null,"timeout",b)},a.timeout)),n=function(){4==b.readyState&&(b.onreadystatechange=B,p(b))},b.send(a.data?h.param(a.data):null),4===b.readyState?y(n):b.onreadystatechange=n;return b};(function(g,a,d){function q(a,b,d,g){var p,
m=x(b),h=b&&b!==r&&!m&&v.getPrototypeOf(b)===l;f(b,function(b,f){p=x(f)?"array":typeof f;g&&(b=d?g:g+"["+(h||"object"==p||"array"==p?b:"")+"]");!g&&m?a.add(f.name,f.value):"array"==p||!d&&"object"==p?q(a,f,d,b):a.add(b,f)})}d.param=function(a,b){var d=[];d.add=function(a,c){this.push(g(a)+(null==c?"":"="+g(c)))};q(d,a,b);return d.join("&").replace(/%20/g,"+")};var b=/^(?:text|application)\/javascript/i,t=/^(?:text|application)\/xml/i;d.mimeToDataType=function(a){a&&(a=a.split(";",2)[0]);return a&&
("text/html"==a?"html":"application/json"==a?"json":b.test(a)?"script":t.test(a)&&"xml")||"text"};var n=a&&a.parse||r.json_decode;d.parseJSON=function(a){try{return n(a)}catch(b){var d=a.replace(/[\n\r]+\s*\/\/[^\n\r]*/g,"");if(d!=a)return n(d);throw b;}};d.createXHR=function(a){f({XMLHttpRequest:function(){return new r.XMLHttpRequest},MSXML2:function(){return new ActiveXObject("Msxml2.XMLHTTP")},MSXML:function(){return new ActiveXObject("Microsoft.XMLHTTP")},MSXML24:function(){return new ActiveXObject("Msxml2.XMLHTTP.4.0")},
REQUEST:function k(){return k.xhr||(k.xhr=require("sdk/request"))}},function(b,f){try{return a=f(),d.createXHR=f,d.xhr_type=b,!1}catch(g){}});return a};d.xhr_supported=d.createXHR(!1)})(encodeURIComponent,JSON,g);g.name=A;return g})})("jajax",this,Object,Array,Function,Date);
